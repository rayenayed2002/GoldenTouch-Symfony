<!DOCTYPE html>
<html lang="en" class="light-style layout-navbar-fixed layout-menu-fixed" dir="ltr" data-theme="theme-default">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
    <title>Statistiques Avanc√©es - Admin</title>
    <meta name="description" content="Admin advanced statistics" />
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{{ asset('img/favicon/favicon.ico') }}" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@latest/tabler-icons.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css">

    <!-- Core CSS -->
    <link rel="stylesheet" href="{{ asset('vendor/css/rtl/core.css') }}" />
    <link rel="stylesheet" href="{{ asset('vendor/css/rtl/theme-default.css') }}" />
    <link rel="stylesheet" href="{{ asset('css/demo.css') }}" />

    <!-- Vendors CSS -->
    <link rel="stylesheet" href="{{ asset('vendor/libs/perfect-scrollbar/perfect-scrollbar.css') }}" />
    <link rel="stylesheet" href="{{ asset('vendor/libs/node-waves/node-waves.css') }}" />
    <link rel="stylesheet" href="{{ asset('vendor/libs/datatables-bs5/datatables.bootstrap5.css') }}" />
    <link rel="stylesheet" href="{{ asset('vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.css') }}" />
    <link rel="stylesheet" href="{{ asset('vendor/libs/datatables-buttons-bs5/buttons.bootstrap5.css') }}" />
    <link rel="stylesheet" href="{{ asset('vendor/libs/sweetalert2/sweetalert2.css') }}" />
    <link rel="stylesheet" href="{{ asset('vendor/libs/flatpickr/flatpickr.css') }}" />
    <link rel="stylesheet" href="{{ asset('vendor/libs/swiper/swiper.css') }}" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" />
    
    <style>
        :root {
            --primary-color: #7367F0;
            --secondary-color: #82868b;
            --success-color: #28C76F;
            --info-color: #00CFE8;
            --warning-color: #FF9F43;
            --danger-color: #EA5455;
        }

        body {
            font-family: 'Inter', sans-serif;
        }

        .dashboard-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: none;
            border-radius: 1rem;
            background: #fff;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .stat-card {
            padding: 1.5rem;
            border-radius: 1rem;
            position: relative;
            overflow: hidden;
        }

        .stat-card .stat-icon {
            position: absolute;
            right: -10px;
            bottom: -10px;
            font-size: 5rem;
            opacity: 0.1;
            transition: all 0.3s ease;
        }

        .stat-card:hover .stat-icon {
            transform: scale(1.2);
            opacity: 0.2;
        }
        
        .cursor-pointer {
            cursor: pointer;
        }
        
        .stat-card.cursor-pointer {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .stat-card.cursor-pointer:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        .stat-card.cursor-pointer:active {
            transform: translateY(-2px);
        }

        .menu-item {
            margin-bottom: 0.5rem;
        }

        .menu-item a {
            border-radius: 0.5rem;
            transition: all 0.3s ease;
        }

        .menu-item a:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .menu-item.active a {
            background-color: var(--primary-color);
            color: white;
            box-shadow: 0 4px 6px -1px rgba(115, 103, 240, 0.2);
        }

        .chart-container {
            padding: 1.5rem;
            border-radius: 1rem;
            background: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .data-table {
            border-radius: 1rem;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .data-table thead th {
            background-color: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
            font-weight: 600;
        }

        .btn {
            border-radius: 0.5rem;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .progress {
            height: 0.5rem;
            border-radius: 1rem;
            background-color: #e9ecef;
        }

        .progress-bar {
            border-radius: 1rem;
            background-color: var(--primary-color);
        }

        /* Loading animation */
        .loading-skeleton {
            animation: skeleton-loading 1s linear infinite alternate;
        }

        @keyframes skeleton-loading {
            0% {
                background-color: #f3f3f3;
            }
            100% {
                background-color: #e0e0e0;
            }
        }

        /* Smooth scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        .pack-metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .pack-metric-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .pack-metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .metric-item {
            background: rgba(var(--bs-primary-rgb), 0.05);
            padding: 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .metric-item:hover {
            background: rgba(var(--bs-primary-rgb), 0.1);
        }

        .satisfaction-bar {
            min-width: 100px;
        }

        .rating-circle {
            width: 100px;
            height: 100px;
        }

        .circular-chart {
            width: 100%;
            height: 100%;
        }

        .circle-bg {
            fill: none;
            stroke: #eee;
            stroke-width: 3.8;
        }

        .circle {
            fill: none;
            stroke: #ffc107;
            stroke-width: 2.8;
            stroke-linecap: round;
            animation: progress 1s ease-out forwards;
        }

        .percentage {
            fill: #666;
            font-size: 0.5em;
            text-anchor: middle;
        }

        @keyframes progress {
            0% {
                stroke-dasharray: 0 100;
            }
        }

        .rating-bars .progress {
            background-color: rgba(0,0,0,0.05);
        }

        .pack-chart {
            border-top: 1px solid var(--border-color);
            padding-top: 1rem;
        }

        @media (max-width: 768px) {
            .pack-metrics-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .stats-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .stats-card h3 {
            color: #2c3e50;
            margin-bottom: 1rem;
            font-size: 1.25rem;
        }
        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 1.5rem;
        }
        .top-events-table {
            width: 100%;
            border-collapse: collapse;
        }
        .top-events-table th, .top-events-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        .top-events-table th {
            background-color: #f8fafc;
            font-weight: 600;
            color: #4a5568;
        }
        .top-events-table tr:hover {
            background-color: #f8fafc;
        }
        .stats-overview {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .stats-item {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .stats-item h4 {
            color: #718096;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }
        .stats-item .value {
            color: #2d3748;
            font-size: 1.5rem;
            font-weight: 600;
        }
    </style>
</head>

<body>
    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar">
        <div class="layout-container">
            <!-- Menu -->
            <aside id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme">
                <div class="app-brand demo">
                    <a href="index.html" class="app-brand-link">
                        <span class="app-brand-logo demo">
                            <svg width="32" height="22" viewBox="0 0 32 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M0.00172773 0V6.85398C0.00172773 6.85398 -0.133178 9.01207 1.98092 10.8388L13.6912 21.9964L19.7809 21.9181L18.8042 9.88248L16.4951 7.17289L9.23799 0H0.00172773Z" fill="#7367F0" />
                            </svg>
                        </span>
                        <span class="app-brand-text demo menu-text fw-bold">Golden Touch</span>
                    </a>
                </div>

                <div class="menu-inner-shadow"></div>

                <ul class="menu-inner py-1">
                    <li class="menu-item">
                        <a href="{{ path('admin_advanced_statistiques_index') }}" class="menu-link">
                            <i class="menu-icon tf-icons ti ti-dashboard"></i>
                            <div>Dashboard</div>
                        </a>
                    </li>
                    
                    <!-- Statistiques -->
                    <li class="menu-item active">
                        <a href="{{ path('admin_advanced_statistiques_index') }}" class="menu-link">
                            <i class="menu-icon tf-icons ti ti-chart-bar"></i>
                            <div>Statistiques</div>
                        </a>
                    </li>

                    <!-- Packs -->
                    <li class="menu-item">
                        <a href="{{ path('admin_pack_index') }}" class="menu-link">
                            <i class="menu-icon tf-icons ti ti-package"></i>
                            <div>Packs</div>
                        </a>
                    </li>

                    <!-- Events -->
                    <li class="menu-item">
                       <a href="{{ path('admin_notifications') }}" class="menu-link">
    <i class="menu-icon tf-icons ti ti-calendar-event"></i>
    <div>Notifications</div>
</a>
                        </a>
                    </li>
                </ul>
            </aside>
            <!-- / Menu -->

            <!-- Layout container -->
            <div class="layout-page">
                <!-- Navbar -->
                <nav class="layout-navbar container-xxl navbar navbar-expand-xl navbar-detached align-items-center bg-navbar-theme" id="layout-navbar">
                    <div class="layout-menu-toggle navbar-nav align-items-xl-center me-3 me-xl-0 d-xl-none">
                        <a class="nav-item nav-link px-0 me-xl-4" href="javascript:void(0)">
                            <i class="ti ti-menu-2 ti-sm"></i>
                        </a>
                    </div>

                    <div class="navbar-nav-right d-flex align-items-center" id="navbar-collapse">
                        <!-- Search -->
                        <div class="navbar-nav align-items-center">
                            <div class="nav-item navbar-search-wrapper mb-0">
                                <a class="nav-item nav-link search-toggler d-flex align-items-center px-0" href="javascript:void(0);">
                                    <i class="ti ti-search ti-md me-2"></i>
                                    <span class="d-none d-md-inline-block text-muted">Search</span>
                                </a>
                            </div>
                        </div>
                        <!-- /Search -->

                        <ul class="navbar-nav flex-row align-items-center ms-auto">
                            <!-- User -->
                            <li class="nav-item navbar-dropdown dropdown-user dropdown">
                                <a class="nav-link dropdown-toggle hide-arrow" href="javascript:void(0);" data-bs-toggle="dropdown">
                                    <div class="avatar avatar-online">
                                        <img src="{{ asset('img/avatars/1.png') }}" alt class="h-auto rounded-circle">
                                    </div>
                                </a>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li>
                                        <a class="dropdown-item" href="#">
                                            <div class="d-flex">
                                                <div class="flex-shrink-0 me-3">
                                                    <div class="avatar avatar-online">
                                                        <img src="{{ asset('img/avatars/1.png') }}" alt class="h-auto rounded-circle">
                                                    </div>
                                                </div>
                                                <div class="flex-grow-1">
                                                    <span class="fw-semibold d-block">Admin</span>
                                                    <small class="text-muted">Administrator</small>
                                                </div>
                                            </div>
                                        </a>
                                    </li>
                                    <li>
                                        <div class="dropdown-divider"></div>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" href="#">
                                            <i class="ti ti-user-check me-2 ti-sm"></i>
                                            <span class="align-middle">My Profile</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" href="#">
                                            <i class="ti ti-settings me-2 ti-sm"></i>
                                            <span class="align-middle">Settings</span>
                                        </a>
                                    </li>
                                </ul>
                            </li>
                            <!--/ User -->
                        </ul>
                    </div>
                </nav>
                <!-- / Navbar -->

                <!-- Content wrapper -->
                <div class="content-wrapper">
                    <!-- Content -->
                    <div class="container-xxl flex-grow-1 container-p-y">
                        <!-- Page Title -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="dashboard-card p-4" data-aos="fade-up">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h3 class="mb-1">Statistiques Avanc√©es üìä</h3>
                                            <p class="text-muted mb-0">Analyse d√©taill√©e des performances de votre entreprise</p>
                                        </div>
                                        <div class="d-flex gap-3">
                                            <button class="btn btn-primary d-flex align-items-center gap-2">
                                                <i class="ri-download-cloud-2-line"></i> T√©l√©charger Rapport
                                            </button>
                                            <button class="btn btn-light" id="refreshStats">
                                                <i class="ri-refresh-line"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Key Metrics -->
                        <div class="row mb-4">
                            <!-- Total Packs -->
                            <div class="col-sm-6 col-lg-3" data-aos="fade-up" data-aos-delay="100">
                                <div class="dashboard-card stat-card bg-primary bg-opacity-10 cursor-pointer" onclick="showAdvancedStatDetails('packs')">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h6 class="text-muted mb-2">Total Packs</h6>
                                            <h2 class="mb-0">{{ packStats.total_packs }}</h2>
                                            <small class="text-success d-flex align-items-center mt-2">
                                                <i class="ri-arrow-up-line me-1"></i> +{{ packStats.growth_rate }}%
                                            </small>
                                        </div>
                                        <div class="stat-icon">
                                            <i class="ri-package-line text-primary"></i>
                                        </div>
                                    </div>
                                    <div class="progress mt-3" style="height: 4px;">
                                        <div class="progress-bar bg-primary" style="width: {{ packStats.growth_rate }}%"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Total Users -->
                            <div class="col-sm-6 col-lg-3" data-aos="fade-up" data-aos-delay="200">
                                <div class="dashboard-card stat-card bg-success bg-opacity-10 cursor-pointer" onclick="showAdvancedStatDetails('users')">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h6 class="text-muted mb-2">Total Utilisateurs</h6>
                                            <h2 class="mb-0">{{ userStats.total_users }}</h2>
                                            <small class="text-success d-flex align-items-center mt-2">
                                                <i class="ri-arrow-up-line me-1"></i> +{{ userStats.growth_rate }}%
                                            </small>
                                        </div>
                                        <div class="stat-icon">
                                            <i class="ri-user-line text-success"></i>
                                        </div>
                                    </div>
                                    <div class="progress mt-3" style="height: 4px;">
                                        <div class="progress-bar bg-success" style="width: {{ userStats.growth_rate }}%"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Most Sold Pack -->
                            <div class="col-sm-6 col-lg-3" data-aos="fade-up" data-aos-delay="300">
                                <div class="dashboard-card stat-card bg-warning bg-opacity-10 cursor-pointer" onclick="showAdvancedStatDetails('mostSoldPack')">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h6 class="text-muted mb-2">Pack le Plus Vendu</h6>
                                            <h2 class="mb-0">{{ mostSoldPack.total_sales }}</h2>
                                            <small class="text-muted d-flex align-items-center mt-2">
                                                {{ mostSoldPack.description|length > 20 ? mostSoldPack.description|slice(0, 20) ~ '...' : mostSoldPack.description }}
                                            </small>
                                        </div>
                                        <div class="stat-icon">
                                            <i class="ri-award-line text-warning"></i>
                                        </div>
                                    </div>
                                    <div class="progress mt-3" style="height: 4px;">
                                        <div class="progress-bar bg-warning" style="width: 65%"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Average Pack Price -->
                            <div class="col-sm-6 col-lg-3" data-aos="fade-up" data-aos-delay="400">
                                <div class="dashboard-card stat-card bg-info bg-opacity-10 cursor-pointer" onclick="showAdvancedStatDetails('avgPrice')">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h6 class="text-muted mb-2">Prix Moyen des Packs</h6>
                                            <h2 class="mb-0">‚Ç¨{{ averagePackPrice }}</h2>
                                            <small class="text-muted d-flex align-items-center mt-2">
                                                Bas√© sur tous les packs
                                            </small>
                                        </div>
                                        <div class="stat-icon">
                                            <i class="ri-money-euro-circle-line text-info"></i>
                                        </div>
                                    </div>
                                    <div class="progress mt-3" style="height: 4px;">
                                        <div class="progress-bar bg-info" style="width: 75%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Charts Row -->
                        <div class="row mb-4">
                            <!-- Reservation Trends -->
                            <div class="col-lg-8" data-aos="fade-up" data-aos-delay="100">
                                <div class="dashboard-card p-4">
                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                        <div>
                                            <h5 class="mb-1">Tendance des R√©servations</h5>
                                            <p class="text-muted mb-0">√âvolution hebdomadaire des r√©servations</p>
                                        </div>
                                        <div class="btn-group">
                                            <button class="btn btn-outline-primary btn-sm active">Semaine</button>
                                            <button class="btn btn-outline-primary btn-sm">Mois</button>
                                            <button class="btn btn-outline-primary btn-sm">Ann√©e</button>
                                        </div>
                                    </div>
                                    <div class="chart-container" style="height: 300px;">
                                        <canvas id="reservationTrendsChart"></canvas>
                                    </div>
                                </div>
                            </div>

                            <!-- Pack Type Distribution -->
                            <div class="col-lg-4" data-aos="fade-up" data-aos-delay="200">
                                <div class="dashboard-card p-4">
                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                        <div>
                                            <h5 class="mb-1">Types de Packs</h5>
                                            <p class="text-muted mb-0">Distribution par cat√©gorie</p>
                                        </div>
                                        <button class="btn btn-light btn-sm">
                                            <i class="ri-more-2-fill"></i>
                                        </button>
                                    </div>
                                    <div class="chart-container" style="height: 300px;">
                                        <canvas id="packTypeChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Active vs Inactive Packs -->
                        <div class="row mb-4">
                            <div class="col-lg-6" data-aos="fade-up" data-aos-delay="100">
                                <div class="dashboard-card p-4">
                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                        <div>
                                            <h5 class="mb-1">Packs Actifs vs Inactifs</h5>
                                            <p class="text-muted mb-0">Statut actuel des packs</p>
                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-center">
                                        <div class="chart-container" style="height: 250px; width: 250px;">
                                            <canvas id="activeInactiveChart"></canvas>
                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-around mt-4">
                                        <div class="text-center">
                                            <h5 class="mb-0">{{ activeInactivePacks.active_packs }}</h5>
                                            <p class="text-muted">Packs Actifs</p>
                                        </div>
                                        <div class="text-center">
                                            <h5 class="mb-0">{{ activeInactivePacks.inactive_packs }}</h5>
                                            <p class="text-muted">Packs Inactifs</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Location Reservations -->
                            <div class="col-lg-6" data-aos="fade-up" data-aos-delay="200">
                                <div class="dashboard-card p-4">
                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                        <div>
                                            <h5 class="mb-1">R√©servations par Lieu</h5>
                                            <p class="text-muted mb-0">Distribution g√©ographique</p>
                                        </div>
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Lieu</th>
                                                    <th>R√©servations</th>
                                                    <th>Pourcentage</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% set totalReservations = 0 %}
                                                {% for location in locationReservations %}
                                                    {% set totalReservations = totalReservations + location.reservation_count %}
                                                {% endfor %}
                                                
                                                {% for location in locationReservations %}
                                                    <tr>
                                                        <td>{{ location.location }}</td>
                                                        <td>{{ location.reservation_count }}</td>
                                                        <td>
                                                            {% set percentage = totalReservations > 0 ? (location.reservation_count / totalReservations * 100)|round : 0 %}
                                                            <div class="d-flex align-items-center">
                                                                <div class="progress flex-grow-1 me-2" style="height: 6px;">
                                                                    <div class="progress-bar bg-primary" style="width: {{ percentage }}%"></div>
                                                                </div>
                                                                <span>{{ percentage }}%</span>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Monthly Revenue Chart -->
                        <div class="row mb-4">
                            <div class="col-12" data-aos="fade-up" data-aos-delay="100">
                                <div class="dashboard-card p-4">
                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                        <div>
                                            <h5 class="mb-1">Revenus Mensuels</h5>
                                            <p class="text-muted mb-0">√âvolution des revenus sur l'ann√©e {{ monthlyRevenue.monthly_data[0].month_name }} - {{ monthlyRevenue.monthly_data[11].month_name }}</p>
                                        </div>
                                        <div class="d-flex align-items-center">
                                            <div class="me-4">
                                                <h6 class="mb-0">Revenu Total</h6>
                                                <h4 class="mb-0">‚Ç¨{{ monthlyRevenue.total_revenue|number_format(2, ',', ' ') }}</h4>
                                            </div>
                                            <div>
                                                <span class="badge bg-{{ monthlyRevenue.year_over_year_growth > 0 ? 'success' : 'danger' }} p-2">
                                                    <i class="ri-{{ monthlyRevenue.year_over_year_growth > 0 ? 'arrow-up' : 'arrow-down' }}-line me-1"></i>
                                                    {{ monthlyRevenue.year_over_year_growth }}% vs ann√©e pr√©c√©dente
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="chart-container" style="height: 350px;">
                                        <canvas id="monthlyRevenueChart"></canvas>
                                    </div>
                                    <div class="row mt-4">
                                        <div class="col-md-4 text-center">
                                            <h6 class="text-muted">Ventes Totales</h6>
                                            <h4>{{ monthlyRevenue.total_sales }}</h4>
                                        </div>
                                        <div class="col-md-4 text-center">
                                            <h6 class="text-muted">Revenu Moyen par Vente</h6>
                                            <h4>‚Ç¨{{ monthlyRevenue.avg_revenue_per_sale|number_format(2, ',', ' ') }}</h4>
                                        </div>
                                        <div class="col-md-4 text-center">
                                            <h6 class="text-muted">Croissance Annuelle</h6>
                                            <h4 class="text-{{ monthlyRevenue.year_over_year_growth > 0 ? 'success' : 'danger' }}">
                                                {{ monthlyRevenue.year_over_year_growth > 0 ? '+' : '' }}{{ monthlyRevenue.year_over_year_growth }}%
                                            </h4>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Customer Satisfaction -->
                        <div class="row mb-4">
                            <div class="col-lg-6" data-aos="fade-up" data-aos-delay="100">
                                <div class="dashboard-card p-4">
                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                        <div>
                                            <h5 class="mb-1">Satisfaction Client</h5>
                                            <p class="text-muted mb-0">Bas√© sur {{ customerSatisfaction.total_reviews }} avis</p>
                                        </div>
                                        <div>
                                            <h2 class="mb-0">{{ customerSatisfaction.avg_rating }}/5</h2>
                                        </div>
                                    </div>
                                    <div class="rating-bars mb-4">
                                        {% for i in 5..1 %}
                                            <div class="d-flex align-items-center mb-2">
                                                <div class="me-2" style="width: 30px;">{{ i }} ‚òÖ</div>
                                                <div class="progress satisfaction-bar flex-grow-1 me-2">
                                                    {% set percentage = customerSatisfaction.total_reviews > 0 ? (customerSatisfaction.rating_distribution[i] / customerSatisfaction.total_reviews * 100) : 0 %}
                                                    <div class="progress-bar bg-{{ i >= 4 ? 'success' : (i == 3 ? 'warning' : 'danger') }}" style="width: {{ percentage }}%"></div>
                                                </div>
                                                <div style="width: 50px;">{{ customerSatisfaction.rating_distribution[i] }}</div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                    <div class="text-center">
                                        <div class="rating-circle mx-auto">
                                            <svg viewBox="0 0 36 36" class="circular-chart">
                                                <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                                <path class="circle" stroke-dasharray="{{ customerSatisfaction.satisfaction_rate }}, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                                <text x="18" y="20.35" class="percentage">{{ customerSatisfaction.satisfaction_rate }}%</text>
                                            </svg>
                                        </div>
                                        <p class="mt-2">Taux de Satisfaction</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-lg-6" data-aos="fade-up" data-aos-delay="200">
                                <div class="dashboard-card p-4">
                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                        <div>
                                            <h5 class="mb-1">Tendance de Satisfaction</h5>
                                            <p class="text-muted mb-0">√âvolution mensuelle de la satisfaction client</p>
                                        </div>
                                    </div>
                                    <div class="chart-container" style="height: 300px;">
                                        <canvas id="satisfactionTrendChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Pack Performance Comparison -->
                        <div class="row mb-4">
                            <div class="col-12" data-aos="fade-up" data-aos-delay="100">
                                <div class="dashboard-card p-4">
                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                        <div>
                                            <h5 class="mb-1">Comparaison de Performance des Packs</h5>
                                            <p class="text-muted mb-0">{{ packPerformanceComparison.current_month }} vs {{ packPerformanceComparison.previous_month }}</p>
                                        </div>
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Pack</th>
                                                    <th>Ventes Actuelles</th>
                                                    <th>Ventes Pr√©c√©dentes</th>
                                                    <th>Croissance</th>
                                                    <th>Revenu Actuel</th>
                                                    <th>Revenu Pr√©c√©dent</th>
                                                    <th>Croissance</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for pack in packPerformanceComparison.comparison_data %}
                                                    <tr>
                                                        <td>{{ pack.description|length > 30 ? pack.description|slice(0, 30) ~ '...' : pack.description }}</td>
                                                        <td>{{ pack.current_month_sales }}</td>
                                                        <td>{{ pack.previous_month_sales }}</td>
                                                        <td>
                                                            <span class="badge bg-{{ pack.sales_growth > 0 ? 'success' : (pack.sales_growth < 0 ? 'danger' : 'secondary') }}">
                                                                {{ pack.sales_growth > 0 ? '+' : '' }}{{ pack.sales_growth }}%
                                                            </span>
                                                        </td>
                                                        <td>‚Ç¨{{ pack.current_month_revenue|number_format(2, ',', ' ') }}</td>
                                                        <td>‚Ç¨{{ pack.previous_month_revenue|number_format(2, ',', ' ') }}</td>
                                                        <td>
                                                            <span class="badge bg-{{ pack.revenue_growth > 0 ? 'success' : (pack.revenue_growth < 0 ? 'danger' : 'secondary') }}">
                                                                {{ pack.revenue_growth > 0 ? '+' : '' }}{{ pack.revenue_growth }}%
                                                            </span>
                                                        </td>
                                                    </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Seasonal Trends -->
                        <div class="row mb-4">
                            <div class="col-lg-8" data-aos="fade-up" data-aos-delay="100">
                                <div class="dashboard-card p-4">
                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                        <div>
                                            <h5 class="mb-1">Tendances Saisonni√®res</h5>
                                            <p class="text-muted mb-0">Distribution des r√©servations par saison</p>
                                        </div>
                                    </div>
                                    <div class="chart-container" style="height: 300px;">
                                        <canvas id="seasonalTrendsChart"></canvas>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-lg-4" data-aos="fade-up" data-aos-delay="200">
                                <div class="dashboard-card p-4">
                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                        <div>
                                            <h5 class="mb-1">Distribution Saisonni√®re</h5>
                                            <p class="text-muted mb-0">R√©partition des revenus par saison</p>
                                        </div>
                                    </div>
                                    <div class="chart-container" style="height: 300px;">
                                        <canvas id="seasonalDistributionChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Top Performing Locations & Conversion Rates -->
                        <div class="row mb-4">
                            <div class="col-lg-6" data-aos="fade-up" data-aos-delay="100">
                                <div class="dashboard-card p-4">
                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                        <div>
                                            <h5 class="mb-1">Lieux les Plus Performants</h5>
                                            <p class="text-muted mb-0">Classement par revenu g√©n√©r√©</p>
                                        </div>
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Lieu</th>
                                                    <th>R√©servations</th>
                                                    <th>Revenu</th>
                                                    <th>% du Total</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for location in topPerformingLocations.locations|slice(0, 5) %}
                                                    <tr>
                                                        <td>{{ location.location }}</td>
                                                        <td>{{ location.reservation_count }}</td>
                                                        <td>‚Ç¨{{ location.total_revenue|number_format(2, ',', ' ') }}</td>
                                                        <td>
                                                            <div class="d-flex align-items-center">
                                                                <div class="progress flex-grow-1 me-2" style="height: 6px;">
                                                                    <div class="progress-bar bg-primary" style="width: {{ location.revenue_percentage }}%"></div>
                                                                </div>
                                                                <span>{{ location.revenue_percentage }}%</span>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-lg-6" data-aos="fade-up" data-aos-delay="200">
                                <div class="dashboard-card p-4">
                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                        <div>
                                            <h5 class="mb-1">Taux de Conversion</h5>
                                            <p class="text-muted mb-0">Efficacit√© du processus de r√©servation</p>
                                        </div>
                                    </div>
                                    <div class="row mb-4">
                                        <div class="col-md-4 text-center">
                                            <div class="metric-item p-3">
                                                <h6 class="text-muted">Vues ‚Üí R√©servations</h6>
                                                <h3>{{ conversionRates.view_to_reservation_rate }}%</h3>
                                                <small>{{ conversionRates.total_reservations }} / {{ conversionRates.total_views }}</small>
                                            </div>
                                        </div>
                                        <div class="col-md-4 text-center">
                                            <div class="metric-item p-3">
                                                <h6 class="text-muted">R√©servations ‚Üí Confirmations</h6>
                                                <h3>{{ conversionRates.reservation_to_confirmation_rate }}%</h3>
                                                <small>{{ conversionRates.confirmed_reservations }} / {{ conversionRates.total_reservations }}</small>
                                            </div>
                                        </div>
                                        <div class="col-md-4 text-center">
                                            <div class="metric-item p-3">
                                                <h6 class="text-muted">Taux Global</h6>
                                                <h3>{{ conversionRates.overall_conversion_rate }}%</h3>
                                                <small>{{ conversionRates.confirmed_reservations }} / {{ conversionRates.total_views }}</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="chart-container" style="height: 200px;">
                                        <canvas id="conversionTrendChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Client Retention & Pack Category Performance -->
                        <div class="row mb-4">
                            <div class="col-lg-6" data-aos="fade-up" data-aos-delay="100">
                                <div class="dashboard-card p-4">
                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                        <div>
                                            <h5 class="mb-1">Fid√©lisation Client</h5>
                                            <p class="text-muted mb-0">Analyse de la r√©tention et fid√©lit√© client</p>
                                        </div>
                                    </div>
                                    <div class="row mb-4">
                                        <div class="col-md-4 text-center">
                                            <div class="metric-item p-3">
                                                <h6 class="text-muted">Clients Totaux</h6>
                                                <h3>{{ clientRetentionRate.total_clients }}</h3>
                                            </div>
                                        </div>
                                        <div class="col-md-4 text-center">
                                            <div class="metric-item p-3">
                                                <h6 class="text-muted">Clients Fid√®les</h6>
                                                <h3>{{ clientRetentionRate.returning_clients }}</h3>
                                                <small>{{ clientRetentionRate.retention_rate }}% de r√©tention</small>
                                            </div>
                                        </div>
                                        <div class="col-md-4 text-center">
                                            <div class="metric-item p-3">
                                                <h6 class="text-muted">R√©servations/Client</h6>
                                                <h3>{{ clientRetentionRate.avg_reservations_per_client }}</h3>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mt-4">
                                        <h6 class="mb-3">Clients les Plus Fid√®les</h6>
                                        <div class="table-responsive">
                                            <table class="table table-sm table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>Client</th>
                                                        <th>R√©servations</th>
                                                        <th>D√©penses Totales</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for client in clientRetentionRate.top_loyal_clients %}
                                                        <tr>
                                                            <td>{{ client.prenom }} {{ client.nom }}</td>
                                                            <td>{{ client.reservation_count }}</td>
                                                            <td>‚Ç¨{{ client.total_spent|number_format(2, ',', ' ') }}</td>
                                                        </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-lg-6" data-aos="fade-up" data-aos-delay="200">
                                <div class="dashboard-card p-4">
                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                        <div>
                                            <h5 class="mb-1">Performance par Cat√©gorie</h5>
                                            <p class="text-muted mb-0">Analyse des performances par type d'√©v√©nement</p>
                                        </div>
                                    </div>
                                    <div class="chart-container" style="height: 250px;">
                                        <canvas id="categoryPerformanceChart"></canvas>
                                    </div>
                                    <div class="table-responsive mt-4">
                                        <table class="table table-sm table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Cat√©gorie</th>
                                                    <th>Packs</th>
                                                    <th>R√©servations</th>
                                                    <th>Revenu</th>
                                                    <th>Note Moyenne</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for category in packCategoryPerformance.categories %}
                                                    <tr>
                                                        <td>{{ category.categorie }}</td>
                                                        <td>{{ category.pack_count }}</td>
                                                        <td>{{ category.reservation_count }}</td>
                                                        <td>‚Ç¨{{ category.total_revenue|number_format(2, ',', ' ') }}</td>
                                                        <td>
                                                            <div class="d-flex align-items-center">
                                                                <div class="me-2">{{ category.avg_rating }}/5</div>
                                                                <div class="progress flex-grow-1" style="height: 6px;">
                                                                    <div class="progress-bar bg-warning" style="width: {{ (category.avg_rating / 5) * 100 }}%"></div>
                                                                </div>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- / Content -->

                    <!-- Footer -->
                    <footer class="content-footer footer bg-footer-theme">
                        <div class="container-xxl d-flex flex-wrap justify-content-between py-2 flex-md-row flex-column">
                            <div class="mb-2 mb-md-0">
                                ¬© 2023 Golden Touch
                            </div>
                        </div>
                    </footer>
                    <!-- / Footer -->

                    <div class="content-backdrop fade"></div>
                </div>
                <!-- Content wrapper -->
            </div>
            <!-- / Layout page -->
        </div>

        <!-- Overlay -->
        <div class="layout-overlay layout-menu-toggle"></div>

        <!-- Drag Target Area To SlideIn Menu On Small Screens -->
        <div class="drag-target"></div>
    </div>
    <!-- / Layout wrapper -->

    <!-- Core JS -->
    <script src="{{ asset('vendor/libs/jquery/jquery.js') }}"></script>
    <script src="{{ asset('vendor/libs/popper/popper.js') }}"></script>
    <script src="{{ asset('vendor/js/bootstrap.js') }}"></script>
    <script src="{{ asset('vendor/libs/perfect-scrollbar/perfect-scrollbar.js') }}"></script>
    <script src="{{ asset('vendor/libs/node-waves/node-waves.js') }}"></script>
    <script src="{{ asset('vendor/libs/hammer/hammer.js') }}"></script>
    <script src="{{ asset('vendor/libs/i18n/i18n.js') }}"></script>
    <script src="{{ asset('vendor/libs/typeahead-js/typeahead.js') }}"></script>
    <script src="{{ asset('vendor/js/menu.js') }}"></script>

    <!-- Vendors JS -->
    <script src="{{ asset('vendor/libs/apex-charts/apexcharts.js') }}"></script>
    <script src="{{ asset('vendor/libs/swiper/swiper.js') }}"></script>
    <script src="{{ asset('vendor/libs/datatables-bs5/datatables-bootstrap5.js') }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>

    <!-- Main JS -->
    <script src="{{ asset('js/main.js') }}"></script>

    <!-- Page JS -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize AOS animations
            AOS.init({
                duration: 800,
                easing: 'ease-in-out',
                once: true
            });

            // Reservation Trends Chart
            const reservationTrendsCtx = document.getElementById('reservationTrendsChart').getContext('2d');
            const reservationTrendsChart = new Chart(reservationTrendsCtx, {
                type: 'line',
                data: {
                    labels: [
                        {% for trend in reservationTrends %}
                            '{{ trend.week|date("d M") }}'{% if not loop.last %},{% endif %}
                        {% endfor %}
                    ],
                    datasets: [{
                        label: 'R√©servations',
                        data: [
                            {% for trend in reservationTrends %}
                                {{ trend.reservation_count }}{% if not loop.last %},{% endif %}
                            {% endfor %}
                        ],
                        borderColor: '#7367F0',
                        backgroundColor: 'rgba(115, 103, 240, 0.1)',
                        borderWidth: 2,
                        pointBackgroundColor: '#7367F0',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 4,
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    return `R√©servations: ${context.raw}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                drawBorder: false,
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            ticks: {
                                stepSize: 5
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });

            // Pack Type Distribution Chart
            const packTypeCtx = document.getElementById('packTypeChart').getContext('2d');
            const packTypeChart = new Chart(packTypeCtx, {
                type: 'doughnut',
                data: {
                    labels: [
                        {% for type in packTypeDistribution %}
                            '{{ type.event_type }}'{% if not loop.last %},{% endif %}
                        {% endfor %}
                    ],
                    datasets: [{
                        data: [
                            {% for type in packTypeDistribution %}
                                {{ type.pack_count }}{% if not loop.last %},{% endif %}
                            {% endfor %}
                        ],
                        backgroundColor: [
                            '#7367F0',
                            '#28C76F',
                            '#FF9F43',
                            '#00CFE8',
                            '#EA5455',
                            '#A8A9AD'
                        ],
                        borderWidth: 0,
                        hoverOffset: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((acc, data) => acc + data, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });

            // Active vs Inactive Packs Chart
            const activeInactiveCtx = document.getElementById('activeInactiveChart').getContext('2d');
            const activeInactiveChart = new Chart(activeInactiveCtx, {
                type: 'pie',
                data: {
                    labels: ['Actifs', 'Inactifs'],
                    datasets: [{
                        data: [
                            {{ activeInactivePacks.active_packs }},
                            {{ activeInactivePacks.inactive_packs }}
                        ],
                        backgroundColor: [
                            '#28C76F',
                            '#EA5455'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((acc, data) => acc + data, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
            
            // Monthly Revenue Chart
            const monthlyRevenueCtx = document.getElementById('monthlyRevenueChart').getContext('2d');
            const monthlyRevenueChart = new Chart(monthlyRevenueCtx, {
                type: 'bar',
                data: {
                    labels: [
                        {% for month in monthlyRevenue.monthly_data %}
                            '{{ month.month_name }}'{% if not loop.last %},{% endif %}
                        {% endfor %}
                    ],
                    datasets: [
                        {
                            label: 'Revenu',
                            data: [
                                {% for month in monthlyRevenue.monthly_data %}
                                    {{ month.revenue }}{% if not loop.last %},{% endif %}
                                {% endfor %}
                            ],
                            backgroundColor: 'rgba(115, 103, 240, 0.7)',
                            borderColor: '#7367F0',
                            borderWidth: 1,
                            borderRadius: 4,
                            order: 1
                        },
                        {
                            label: 'Ventes',
                            data: [
                                {% for month in monthlyRevenue.monthly_data %}
                                    {{ month.sales_count }}{% if not loop.last %},{% endif %}
                                {% endfor %}
                            ],
                            type: 'line',
                            borderColor: '#FF9F43',
                            backgroundColor: 'rgba(255, 159, 67, 0.1)',
                            borderWidth: 2,
                            pointBackgroundColor: '#FF9F43',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 4,
                            tension: 0.3,
                            fill: false,
                            order: 0,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            align: 'end'
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    if (context.dataset.label === 'Revenu') {
                                        return `Revenu: ‚Ç¨${context.raw.toLocaleString('fr-FR', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                                    } else {
                                        return `Ventes: ${context.raw}`;
                                    }
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                drawBorder: false,
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return '‚Ç¨' + value.toLocaleString('fr-FR');
                                }
                            },
                            title: {
                                display: true,
                                text: 'Revenu'
                            }
                        },
                        y1: {
                            beginAtZero: true,
                            position: 'right',
                            grid: {
                                display: false
                            },
                            title: {
                                display: true,
                                text: 'Ventes'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
            
            // Satisfaction Trend Chart
            const satisfactionTrendCtx = document.getElementById('satisfactionTrendChart').getContext('2d');
            const satisfactionTrendChart = new Chart(satisfactionTrendCtx, {
                type: 'line',
                data: {
                    labels: [
                        {% for trend in customerSatisfaction.monthly_trend %}
                            '{{ trend.period }}'{% if not loop.last %},{% endif %}
                        {% endfor %}
                    ],
                    datasets: [
                        {
                            label: 'Note Moyenne',
                            data: [
                                {% for trend in customerSatisfaction.monthly_trend %}
                                    {{ trend.avg_rating }}{% if not loop.last %},{% endif %}
                                {% endfor %}
                            ],
                            borderColor: '#FF9F43',
                            backgroundColor: 'rgba(255, 159, 67, 0.1)',
                            borderWidth: 2,
                            pointBackgroundColor: '#FF9F43',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 4,
                            tension: 0.3,
                            fill: true,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Nombre d\'Avis',
                            data: [
                                {% for trend in customerSatisfaction.monthly_trend %}
                                    {{ trend.review_count }}{% if not loop.last %},{% endif %}
                                {% endfor %}
                            ],
                            type: 'bar',
                            backgroundColor: 'rgba(115, 103, 240, 0.3)',
                            borderColor: '#7367F0',
                            borderWidth: 1,
                            borderRadius: 4,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            align: 'end'
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    scales: {
                        y: {
                            min: 0,
                            max: 5,
                            grid: {
                                drawBorder: false,
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            title: {
                                display: true,
                                text: 'Note Moyenne'
                            }
                        },
                        y1: {
                            beginAtZero: true,
                            position: 'right',
                            grid: {
                                display: false
                            },
                            title: {
                                display: true,
                                text: 'Nombre d\'Avis'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
            
            // Seasonal Trends Chart
            const seasonalTrendsCtx = document.getElementById('seasonalTrendsChart').getContext('2d');
            const seasonalTrendsChart = new Chart(seasonalTrendsCtx, {
                type: 'line',
                data: {
                    labels: [
                        {% for month in seasonalTrends.monthly_data %}
                            '{{ month.month }}'{% if not loop.last %},{% endif %}
                        {% endfor %}
                    ],
                    datasets: [
                        {
                            label: 'R√©servations',
                            data: [
                                {% for month in seasonalTrends.monthly_data %}
                                    {{ month.reservation_count }}{% if not loop.last %},{% endif %}
                                {% endfor %}
                            ],
                            borderColor: '#7367F0',
                            backgroundColor: 'rgba(115, 103, 240, 0.1)',
                            borderWidth: 2,
                            pointBackgroundColor: '#7367F0',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 4,
                            tension: 0.3,
                            fill: true
                        },
                        {
                            label: 'Revenu',
                            data: [
                                {% for month in seasonalTrends.monthly_data %}
                                    {{ month.revenue }}{% if not loop.last %},{% endif %}
                                {% endfor %}
                            ],
                            borderColor: '#28C76F',
                            backgroundColor: 'rgba(40, 199, 111, 0.1)',
                            borderWidth: 2,
                            pointBackgroundColor: '#28C76F',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 4,
                            tension: 0.3,
                            fill: true,
                            hidden: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            align: 'end'
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    if (context.dataset.label === 'Revenu') {
                                        return `Revenu: ‚Ç¨${context.raw.toLocaleString('fr-FR', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                                    } else {
                                        return `R√©servations: ${context.raw}`;
                                    }
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                drawBorder: false,
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
            
            // Seasonal Distribution Chart
            const seasonalDistributionCtx = document.getElementById('seasonalDistributionChart').getContext('2d');
            const seasonalDistributionChart = new Chart(seasonalDistributionCtx, {
                type: 'doughnut',
                data: {
                    labels: [
                        {% for season in seasonalTrends.seasonal_data %}
                            '{{ season.season }}'{% if not loop.last %},{% endif %}
                        {% endfor %}
                    ],
                    datasets: [{
                        data: [
                            {% for season in seasonalTrends.seasonal_data %}
                                {{ season.revenue }}{% if not loop.last %},{% endif %}
                            {% endfor %}
                        ],
                        backgroundColor: [
                            '#00CFE8', // Winter
                            '#28C76F', // Spring
                            '#FF9F43', // Summer
                            '#7367F0'  // Fall
                        ],
                        borderWidth: 0,
                        hoverOffset: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((acc, data) => acc + data, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ‚Ç¨${value.toLocaleString('fr-FR', {minimumFractionDigits: 2, maximumFractionDigits: 2})} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
            
            // Conversion Trend Chart
            const conversionTrendCtx = document.getElementById('conversionTrendChart').getContext('2d');
            const conversionTrendChart = new Chart(conversionTrendCtx, {
                type: 'line',
                data: {
                    labels: [
                        {% for trend in conversionRates.monthly_trend %}
                            '{{ trend.period }}'{% if not loop.last %},{% endif %}
                        {% endfor %}
                    ],
                    datasets: [{
                        label: 'Taux de Conversion',
                        data: [
                            {% for trend in conversionRates.monthly_trend %}
                                {{ trend.conversion_rate }}{% if not loop.last %},{% endif %}
                            {% endfor %}
                        ],
                        borderColor: '#7367F0',
                        backgroundColor: 'rgba(115, 103, 240, 0.1)',
                        borderWidth: 2,
                        pointBackgroundColor: '#7367F0',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 4,
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    return `Taux de Conversion: ${context.raw}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                drawBorder: false,
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
            
            // Category Performance Chart
            const categoryPerformanceCtx = document.getElementById('categoryPerformanceChart').getContext('2d');
            const categoryPerformanceChart = new Chart(categoryPerformanceCtx, {
                type: 'bar',
                data: {
                    labels: [
                        {% for category in packCategoryPerformance.categories %}
                            '{{ category.categorie }}'{% if not loop.last %},{% endif %}
                        {% endfor %}
                    ],
                    datasets: [
                        {
                            label: 'Revenu',
                            data: [
                                {% for category in packCategoryPerformance.categories %}
                                    {{ category.total_revenue }}{% if not loop.last %},{% endif %}
                                {% endfor %}
                            ],
                            backgroundColor: 'rgba(115, 103, 240, 0.7)',
                            borderColor: '#7367F0',
                            borderWidth: 1,
                            borderRadius: 4
                        },
                        {
                            label: 'Note Moyenne',
                            data: [
                                {% for category in packCategoryPerformance.categories %}
                                    {{ category.avg_rating }}{% if not loop.last %},{% endif %}
                                {% endfor %}
                            ],
                            type: 'line',
                            borderColor: '#FF9F43',
                            backgroundColor: 'rgba(255, 159, 67, 0.1)',
                            borderWidth: 2,
                            pointBackgroundColor: '#FF9F43',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 4,
                            tension: 0.3,
                            fill: false,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            align: 'end'
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    if (context.dataset.label === 'Revenu') {
                                        return `Revenu: ‚Ç¨${context.raw.toLocaleString('fr-FR', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                                    } else {
                                        return `Note Moyenne: ${context.raw}/5`;
                                    }
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                drawBorder: false,
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        y1: {
                            beginAtZero: true,
                            position: 'right',
                            grid: {
                                display: false
                            },
                            ticks: {
                                max: 5,
                                stepSize: 1
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
            
            // Initialize AOS animations
            AOS.init({
                duration: 800,
                easing: 'ease-in-out',
                once: true
            });
            
            // Function to show detailed statistics when a card is clicked
            function showAdvancedStatDetails(statType) {
                // Default data structure for statistics
                const detailedStats = {
                    packs: {
                        title: 'Statistiques D√©taill√©es des Packs',
                        icon: 'ri-package-line',
                        color: 'primary',
                        today: {
                            value: 25,
                            growth: '+15%'
                        },
                        thisWeek: {
                            value: 142,
                            growth: '+22%'
                        },
                        thisMonth: {
                            value: 587,
                            growth: '+12.5%'
                        },
                        thisYear: {
                            value: 2845,
                            growth: '+18.3%'
                        },
                        totalSales: {{ packStats.total_packs }},
                        growthRate: '+{{ packStats.growth_rate }}%'
                    },
                    users: {
                        title: 'Statistiques D√©taill√©es des Utilisateurs',
                        icon: 'ri-user-line',
                        color: 'success',
                        today: {
                            value: 18,
                            growth: '+10%'
                        },
                        thisWeek: {
                            value: 98,
                            growth: '+15%'
                        },
                        thisMonth: {
                            value: 412,
                            growth: '+8.5%'
                        },
                        thisYear: {
                            value: 1845,
                            growth: '+14.3%'
                        },
                        totalSales: {{ userStats.total_users }},
                        growthRate: '+{{ userStats.growth_rate }}%'
                    },
                    mostSoldPack: {
                        title: 'Statistiques D√©taill√©es du Pack le Plus Vendu',
                        icon: 'ri-award-line',
                        color: 'warning',
                        today: {
                            value: 8,
                            growth: '+5%'
                        },
                        thisWeek: {
                            value: 45,
                            growth: '+12%'
                        },
                        thisMonth: {
                            value: 187,
                            growth: '+9.5%'
                        },
                        thisYear: {
                            value: 945,
                            growth: '+11.3%'
                        },
                        totalSales: {{ mostSoldPack.total_sales }},
                        growthRate: '+12.5%'
                    }
                };
                
                // Get the selected stat data
                const statData = detailedStats[statType];
                
                // Update modal content with the selected stat data
                document.getElementById('statDetailsTitle').textContent = statData.title;
                document.getElementById('statDetailsIcon').className = `${statData.icon} text-${statData.color}`;
                
                // Update the detailed statistics
                document.getElementById('statToday').textContent = statData.today.value;
                document.getElementById('statTodayGrowth').textContent = statData.today.growth;
                
                document.getElementById('statThisWeek').textContent = statData.thisWeek.value;
                document.getElementById('statThisWeekGrowth').textContent = statData.thisWeek.growth;
                
                document.getElementById('statThisMonth').textContent = statData.thisMonth.value;
                document.getElementById('statThisMonthGrowth').textContent = statData.thisMonth.growth;
                
                document.getElementById('statThisYear').textContent = statData.thisYear.value;
                document.getElementById('statThisYearGrowth').textContent = statData.thisYear.growth;
                
                document.getElementById('statTotalSales').textContent = statData.totalSales;
                document.getElementById('statTotalGrowth').textContent = statData.growthRate;
                
                // Show the modal
                const statDetailsModal = new bootstrap.Modal(document.getElementById('statDetailsModal'));
                statDetailsModal.show();
            }
        });
    </script>
    
    <!-- Statistics Details Modal -->
    <div class="modal fade" id="statDetailsModal" tabindex="-1" aria-labelledby="statDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="statDetailsModalLabel">
                        <i id="statDetailsIcon" class="ri-package-line text-primary me-2"></i>
                        <span id="statDetailsTitle">Statistiques D√©taill√©es</span>
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-4">
                        <div class="col-12 mb-4">
                            <div class="dashboard-card p-4">
                                <h5 class="mb-3">Total des Ventes</h5>
                                <div class="d-flex align-items-center">
                                    <h2 class="mb-0" id="statTotalSales">0</h2>
                                    <span class="badge bg-success ms-2" id="statTotalGrowth">+0%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <h5 class="mb-3">Analyse des Ventes</h5>
                    <div class="row g-3 mb-4">
                        <!-- Today -->
                        <div class="col-md-6 col-lg-3">
                            <div class="dashboard-card p-3">
                                <h6 class="text-muted mb-2">Aujourd'hui</h6>
                                <div class="d-flex align-items-baseline">
                                    <h3 class="mb-0" id="statToday">25</h3>
                                    <small class="text-success ms-2" id="statTodayGrowth">+15%</small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- This Week -->
                        <div class="col-md-6 col-lg-3">
                            <div class="dashboard-card p-3">
                                <h6 class="text-muted mb-2">Cette Semaine</h6>
                                <div class="d-flex align-items-baseline">
                                    <h3 class="mb-0" id="statThisWeek">142</h3>
                                    <small class="text-success ms-2" id="statThisWeekGrowth">+22%</small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- This Month -->
                        <div class="col-md-6 col-lg-3">
                            <div class="dashboard-card p-3">
                                <h6 class="text-muted mb-2">Ce Mois</h6>
                                <div class="d-flex align-items-baseline">
                                    <h3 class="mb-0" id="statThisMonth">587</h3>
                                    <small class="text-success ms-2" id="statThisMonthGrowth">+12.5%</small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- This Year -->
                        <div class="col-md-6 col-lg-3">
                            <div class="dashboard-card p-3">
                                <h6 class="text-muted mb-2">Cette Ann√©e</h6>
                                <div class="d-flex align-items-baseline">
                                    <h3 class="mb-0" id="statThisYear">2,845</h3>
                                    <small class="text-success ms-2" id="statThisYearGrowth">+18.3%</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-12">
                            <div class="dashboard-card p-4">
                                <h5 class="mb-3">Tendance des Ventes</h5>
                                <div style="height: 250px;">
                                    <canvas id="statDetailsTrendChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
                    <button type="button" class="btn btn-primary">T√©l√©charger Rapport</button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>