<!DOCTYPE html>
<html lang="en" class="light-style layout-navbar-fixed layout-menu-fixed" dir="ltr" data-theme="theme-default">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
    <title>Statistiques des Réservations - Admin</title>
    <meta name="description" content="Statistiques des réservations de matériel" />
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{{ asset('img/favicon/favicon.ico') }}" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@latest/tabler-icons.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css">

    <!-- Core CSS -->
    <link rel="stylesheet" href="{{ asset('vendor/css/rtl/core.css') }}" />
    <link rel="stylesheet" href="{{ asset('vendor/css/rtl/theme-default.css') }}" />
    <link rel="stylesheet" href="{{ asset('css/demo.css') }}" />

    <!-- Vendors CSS -->
    <link rel="stylesheet" href="{{ asset('vendor/libs/perfect-scrollbar/perfect-scrollbar.css') }}" />
    <link rel="stylesheet" href="{{ asset('vendor/libs/node-waves/node-waves.css') }}" />
    <link rel="stylesheet" href="{{ asset('vendor/libs/datatables-bs5/datatables.bootstrap5.css') }}" />
    <link rel="stylesheet" href="{{ asset('vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.css') }}" />
    <link rel="stylesheet" href="{{ asset('vendor/libs/datatables-buttons-bs5/buttons.bootstrap5.css') }}" />
    <link rel="stylesheet" href="{{ asset('vendor/libs/sweetalert2/sweetalert2.css') }}" />
    <link rel="stylesheet" href="{{ asset('vendor/libs/flatpickr/flatpickr.css') }}" />
    <link rel="stylesheet" href="{{ asset('vendor/libs/swiper/swiper.css') }}" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" />
    
    <style>
        :root {
            --primary-color: #7367F0;
            --secondary-color: #82868b;
            --success-color: #28C76F;
            --info-color: #00CFE8;
            --warning-color: #FF9F43;
            --danger-color: #EA5455;
        }

        body {
            font-family: 'Inter', sans-serif;
        }

        .dashboard-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: none;
            border-radius: 1rem;
            background: #fff;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .stat-card {
            padding: 1.5rem;
            border-radius: 1rem;
            position: relative;
            overflow: hidden;
        }

        .stat-card .stat-icon {
            position: absolute;
            right: -10px;
            bottom: -10px;
            font-size: 5rem;
            opacity: 0.1;
            transition: all 0.3s ease;
        }

        .stat-card:hover .stat-icon {
            transform: scale(1.2);
            opacity: 0.2;
        }
        
        .cursor-pointer {
            cursor: pointer;
        }
        
        .stat-card.cursor-pointer {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .stat-card.cursor-pointer:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        .stat-card.cursor-pointer:active {
            transform: translateY(-2px);
        }

        .menu-item {
            margin-bottom: 0.5rem;
        }

        .menu-item a {
            border-radius: 0.5rem;
            transition: all 0.3s ease;
        }

        .menu-item a:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .menu-item.active a {
            background-color: var(--primary-color);
            color: white;
            box-shadow: 0 4px 6px -1px rgba(115, 103, 240, 0.2);
        }

        .chart-container {
            padding: 1.5rem;
            border-radius: 1rem;
            background: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .data-table {
            border-radius: 1rem;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .data-table thead th {
            background-color: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
            font-weight: 600;
        }

        .btn {
            border-radius: 0.5rem;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .progress {
            height: 0.5rem;
            border-radius: 1rem;
            background-color: #e9ecef;
        }

        .progress-bar {
            border-radius: 1rem;
            background-color: var(--primary-color);
        }

        /* Loading animation */
        .loading-skeleton {
            animation: skeleton-loading 1s linear infinite alternate;
        }

        @keyframes skeleton-loading {
            0% {
                background-color: #f3f3f3;
            }
            100% {
                background-color: #e0e0e0;
            }
        }

        /* Smooth scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        .pack-metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .pack-metric-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .pack-metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .metric-item {
            background: rgba(var(--bs-primary-rgb), 0.05);
            padding: 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .metric-item:hover {
            background: rgba(var(--bs-primary-rgb), 0.1);
        }

        .satisfaction-bar {
            min-width: 100px;
        }

        .rating-circle {
            width: 100px;
            height: 100px;
        }

        .circular-chart {
            width: 100%;
            height: 100%;
        }

        .circle-bg {
            fill: none;
            stroke: #eee;
            stroke-width: 3.8;
        }

        .circle {
            fill: none;
            stroke: #ffc107;
            stroke-width: 2.8;
            stroke-linecap: round;
            animation: progress 1s ease-out forwards;
        }

        .percentage {
            fill: #666;
            font-size: 0.5em;
            text-anchor: middle;
        }

        @keyframes progress {
            0% {
                stroke-dasharray: 0 100;
            }
        }

        .rating-bars .progress {
            background-color: rgba(0,0,0,0.05);
        }

        .pack-chart {
            border-top: 1px solid var(--border-color);
            padding-top: 1rem;
        }

        @media (max-width: 768px) {
            .pack-metrics-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .stats-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .stats-card h3 {
            color: #2c3e50;
            margin-bottom: 1rem;
            font-size: 1.25rem;
        }
        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 1.5rem;
        }
        .top-events-table {
            width: 100%;
            border-collapse: collapse;
        }
        .top-events-table th, .top-events-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        .top-events-table th {
            background-color: #f8fafc;
            font-weight: 600;
            color: #4a5568;
        }
        .top-events-table tr:hover {
            background-color: #f8fafc;
        }
        .stats-overview {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .stats-item {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .stats-item h4 {
            color: #718096;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }
        .stats-item .value {
            color: #2d3748;
            font-size: 1.5rem;
            font-weight: 600;
        }
    </style>
</head>

<body>
    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar">
        <div class="layout-container">
            <!-- Menu -->
            <aside id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme">
                <div class="app-brand demo">
                    <a href="index.html" class="app-brand-link">
                        <span class="app-brand-logo demo">
                            <svg width="32" height="22" viewBox="0 0 32 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M0.00172773 0V6.85398C0.00172773 6.85398 -0.133178 9.01207 1.98092 10.8388L13.6912 21.9964L19.7809 21.9181L18.8042 9.88248L16.4951 7.17289L9.23799 0H0.00172773Z" fill="#7367F0" />
                            </svg>
                        </span>
                        <span class="app-brand-text demo menu-text fw-bold">Golden Touch</span>
                    </a>
                </div>

                <div class="menu-inner-shadow"></div>

                <ul class="menu-inner py-1">
                    <li class="menu-item">
                        <a href="{{ path('admin_dashboard') }}" class="menu-link">
                            <i class="menu-icon tf-icons ti ti-dashboard"></i>
                            <div>Dashboard</div>
                        </a>
                    </li>
                    
                    <!-- Statistiques -->
                    <li class="menu-item active">
                        <a href="{{ path('admin_reservations_statistiques') }}" class="menu-link">
                            <i class="menu-icon tf-icons ti ti-chart-bar"></i>
                            <div>Statistiques Réservations</div>
                        </a>
                    </li>

                    <!-- Packs -->
                    <li class="menu-item">
                        <a href="{{ path('admin_pack_index') }}" class="menu-link">
                            <i class="menu-icon tf-icons ti ti-package"></i>
                            <div>Packs</div>
                        </a>
                    </li>

                    <!-- Events -->
                    <li class="menu-item">
                        <a href="#" class="menu-link">
                            <i class="menu-icon tf-icons ti ti-calendar-event"></i>
                            <div>Events</div>
                        </a>
                    </li>
                </ul>
            </aside>
            <!-- / Menu -->

            <!-- Layout container -->
            <div class="layout-page">
                <!-- Navbar -->
                <nav class="layout-navbar container-xxl navbar navbar-expand-xl navbar-detached align-items-center bg-navbar-theme" id="layout-navbar">
                    <div class="layout-menu-toggle navbar-nav align-items-xl-center me-3 me-xl-0 d-xl-none">
                        <a class="nav-item nav-link px-0 me-xl-4" href="javascript:void(0)">
                            <i class="ti ti-menu-2 ti-sm"></i>
                        </a>
                    </div>

                    <div class="navbar-nav-right d-flex align-items-center" id="navbar-collapse">
                        <!-- Search -->
                        <div class="navbar-nav align-items-center">
                            <div class="nav-item navbar-search-wrapper mb-0">
                                <a class="nav-item nav-link search-toggler d-flex align-items-center px-0" href="javascript:void(0);">
                                    <i class="ti ti-search ti-md me-2"></i>
                                    <span class="d-none d-md-inline-block text-muted">Search</span>
                                </a>
                            </div>
                        </div>
                        <!-- /Search -->

                        <ul class="navbar-nav flex-row align-items-center ms-auto">
                            <!-- User -->
                            <li class="nav-item navbar-dropdown dropdown-user dropdown">
                                <a class="nav-link dropdown-toggle hide-arrow" href="javascript:void(0);" data-bs-toggle="dropdown">
                                    <div class="avatar avatar-online">
                                        <img src="{{ asset('img/avatars/1.png') }}" alt class="h-auto rounded-circle">
                                    </div>
                                </a>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li>
                                        <a class="dropdown-item" href="#">
                                            <div class="d-flex">
                                                <div class="flex-shrink-0 me-3">
                                                    <div class="avatar avatar-online">
                                                        <img src="{{ asset('img/avatars/1.png') }}" alt class="h-auto rounded-circle">
                                                    </div>
                                                </div>
                                                <div class="flex-grow-1">
                                                    <span class="fw-semibold d-block">Admin</span>
                                                    <small class="text-muted">Administrator</small>
                                                </div>
                                            </div>
                                        </a>
                                    </li>
                                    <li>
                                        <div class="dropdown-divider"></div>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" href="#">
                                            <i class="ti ti-user-check me-2 ti-sm"></i>
                                            <span class="align-middle">My Profile</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" href="#">
                                            <i class="ti ti-settings me-2 ti-sm"></i>
                                            <span class="align-middle">Settings</span>
                                        </a>
                                    </li>
                                </ul>
                            </li>
                            <!--/ User -->
                        </ul>
                    </div>
                </nav>
                <!-- / Navbar -->

                <!-- Content wrapper -->
                <div class="content-wrapper">
                    <!-- Content -->
                    <div class="container-xxl flex-grow-1 container-p-y">
                        <!-- Page Title -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="dashboard-card p-4" data-aos="fade-up">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h3 class="mb-1">Statistiques des Réservations 📊</h3>
                                            <p class="text-muted mb-0">Analyse détaillée des réservations de matériel</p>
                                        </div>
                                        <div class="d-flex gap-3">
                                            <button class="btn btn-primary d-flex align-items-center gap-2">
                                                <i class="ri-download-cloud-2-line"></i> Télécharger Rapport
                                            </button>
                                            <button class="btn btn-light" id="refreshStats">
                                                <i class="ri-refresh-line"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Key Metrics -->
                        <div class="row mb-4">
                            <!-- Total Reservations -->
                            <div class="col-sm-6 col-lg-3" data-aos="fade-up" data-aos-delay="100">
                                <div class="dashboard-card stat-card bg-primary bg-opacity-10 cursor-pointer" onclick="showAdvancedStatDetails('reservations')">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h6 class="text-muted mb-2">Total Réservations</h6>
                                            <h2 class="mb-0">{{ stats.total_reservations }}</h2>
                                            <small class="text-success d-flex align-items-center mt-2">
                                                <i class="ri-arrow-up-line me-1"></i> +{{ stats.reservation_growth }}%
                                            </small>
                                        </div>
                                        <div class="stat-icon">
                                            <i class="ri-calendar-check-line text-primary"></i>
                                        </div>
                                    </div>
                                    <div class="progress mt-3" style="height: 4px;">
                                        <div class="progress-bar bg-primary" style="width: {{ stats.reservation_growth }}%"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Confirmed Reservations -->
                            <div class="col-sm-6 col-lg-3" data-aos="fade-up" data-aos-delay="200">
                                <div class="dashboard-card stat-card bg-success bg-opacity-10 cursor-pointer" onclick="showAdvancedStatDetails('confirmed')">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h6 class="text-muted mb-2">Confirmées</h6>
                                            <h2 class="mb-0">{{ stats.confirmed_reservations }}</h2>
                                            <small class="text-muted d-flex align-items-center mt-2">
                                                {{ ((stats.confirmed_reservations / stats.total_reservations) * 100)|round }}% du total
                                            </small>
                                        </div>
                                        <div class="stat-icon">
                                            <i class="ri-checkbox-circle-line text-success"></i>
                                        </div>
                                    </div>
                                    <div class="progress mt-3" style="height: 4px;">
                                        <div class="progress-bar bg-success" style="width: {{ ((stats.confirmed_reservations / stats.total_reservations) * 100)|round }}%"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Pending Reservations -->
                            <div class="col-sm-6 col-lg-3" data-aos="fade-up" data-aos-delay="300">
                                <div class="dashboard-card stat-card bg-warning bg-opacity-10 cursor-pointer" onclick="showAdvancedStatDetails('pending')">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h6 class="text-muted mb-2">En Attente</h6>
                                            <h2 class="mb-0">{{ stats.pending_reservations }}</h2>
                                            <small class="text-muted d-flex align-items-center mt-2">
                                                {{ ((stats.pending_reservations / stats.total_reservations) * 100)|round }}% du total
                                            </small>
                                        </div>
                                        <div class="stat-icon">
                                            <i class="ri-time-line text-warning"></i>
                                        </div>
                                    </div>
                                    <div class="progress mt-3" style="height: 4px;">
                                        <div class="progress-bar bg-warning" style="width: {{ ((stats.pending_reservations / stats.total_reservations) * 100)|round }}%"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Cancelled Reservations -->
                            <div class="col-sm-6 col-lg-3" data-aos="fade-up" data-aos-delay="400">
                                <div class="dashboard-card stat-card bg-danger bg-opacity-10 cursor-pointer" onclick="showAdvancedStatDetails('cancelled')">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h6 class="text-muted mb-2">Annulées</h6>
                                            <h2 class="mb-0">{{ stats.cancelled_reservations }}</h2>
                                            <small class="text-muted d-flex align-items-center mt-2">
                                                {{ ((stats.cancelled_reservations / stats.total_reservations) * 100)|round }}% du total
                                            </small>
                                        </div>
                                        <div class="stat-icon">
                                            <i class="ri-close-circle-line text-danger"></i>
                                        </div>
                                    </div>
                                    <div class="progress mt-3" style="height: 4px;">
                                        <div class="progress-bar bg-danger" style="width: {{ ((stats.cancelled_reservations / stats.total_reservations) * 100)|round }}%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Charts Row -->
                        <div class="row mb-4">
                            <!-- Reservation Trends -->
                            <div class="col-lg-8" data-aos="fade-up" data-aos-delay="100">
                                <div class="dashboard-card p-4">
                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                        <div>
                                            <h5 class="mb-1">Tendance des Réservations</h5>
                                            <p class="text-muted mb-0">Évolution mensuelle des réservations</p>
                                        </div>
                                        <div class="btn-group">
                                            <button class="btn btn-outline-primary btn-sm active">Mois</button>
                                            <button class="btn btn-outline-primary btn-sm">Semaine</button>
                                            <button class="btn btn-outline-primary btn-sm">Année</button>
                                        </div>
                                    </div>
                                    <div class="chart-container" style="height: 300px;">
                                        <canvas id="reservationTrendsChart"></canvas>
                                    </div>
                                </div>
                            </div>

                            <!-- Status Distribution -->
                            <div class="col-lg-4" data-aos="fade-up" data-aos-delay="200">
                                <div class="dashboard-card p-4">
                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                        <div>
                                            <h5 class="mb-1">Statut des Réservations</h5>
                                            <p class="text-muted mb-0">Répartition par statut</p>
                                        </div>
                                        <button class="btn btn-light btn-sm">
                                            <i class="ri-more-2-fill"></i>
                                        </button>
                                    </div>
                                    <div class="chart-container" style="height: 300px;">
                                        <canvas id="statusDistributionChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Material Usage -->
                        <div class="row mb-4">
                            <div class="col-lg-6" data-aos="fade-up" data-aos-delay="100">
                                <div class="dashboard-card p-4">
                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                        <div>
                                            <h5 class="mb-1">Matériels les Plus Réservés</h5>
                                            <p class="text-muted mb-0">Classement par nombre de réservations</p>
                                        </div>
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Matériel</th>
                                                    <th>Réservations</th>
                                                    <th>Quantité Totale</th>
                                                    <th>Pourcentage</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for material in stats.top_materials %}
                                                    <tr>
                                                        <td>{{ material.nom_mat }}</td>
                                                        <td>{{ material.reservation_count }}</td>
                                                        <td>{{ material.total_quantity }}</td>
                                                        <td>
                                                            {% set percentage = (material.reservation_count / stats.total_reservations * 100)|round %}
                                                            <div class="d-flex align-items-center">
                                                                <div class="progress flex-grow-1 me-2" style="height: 6px;">
                                                                    <div class="progress-bar bg-primary" style="width: {{ percentage }}%"></div>
                                                                </div>
                                                                <span>{{ percentage }}%</span>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <!-- Events with Most Reservations -->
                            <div class="col-lg-6" data-aos="fade-up" data-aos-delay="200">
                                <div class="dashboard-card p-4">
                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                        <div>
                                            <h5 class="mb-1">Événements avec le Plus de Réservations</h5>
                                            <p class="text-muted mb-0">Top 5 des événements</p>
                                        </div>
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Événement</th>
                                                    <th>Réservations</th>
                                                    <th>Matériels Différents</th>
                                                    <th>Pourcentage</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for event in stats.top_events %}
                                                    <tr>
                                                        <td>{{ event.nom }}</td>
                                                        <td>{{ event.reservation_count }}</td>
                                                        <td>{{ event.unique_materials }}</td>
                                                        <td>
                                                            {% set percentage = (event.reservation_count / stats.total_reservations * 100)|round %}
                                                            <div class="d-flex align-items-center">
                                                                <div class="progress flex-grow-1 me-2" style="height: 6px;">
                                                                    <div class="progress-bar bg-primary" style="width: {{ percentage }}%"></div>
                                                                </div>
                                                                <span>{{ percentage }}%</span>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Monthly Reservation Chart -->
                        <div class="row mb-4">
                            <div class="col-12" data-aos="fade-up" data-aos-delay="100">
                                <div class="dashboard-card p-4">
                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                        <div>
                                            <h5 class="mb-1">Réservations Mensuelles</h5>
                                            <p class="text-muted mb-0">Évolution des réservations sur l'année</p>
                                        </div>
                                        <div class="d-flex align-items-center">
                                            <div class="me-4">
                                                <h6 class="mb-0">Total Réservations</h6>
                                                <h4 class="mb-0">{{ stats.total_reservations }}</h4>
                                            </div>
                                            <div>
                                                <span class="badge bg-{{ stats.year_over_year_growth > 0 ? 'success' : 'danger' }} p-2">
                                                    <i class="ri-{{ stats.year_over_year_growth > 0 ? 'arrow-up' : 'arrow-down' }}-line me-1"></i>
                                                    {{ stats.year_over_year_growth }}% vs année précédente
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="chart-container" style="height: 350px;">
                                        <canvas id="monthlyReservationChart"></canvas>
                                    </div>
                                    <div class="row mt-4">
                                        <div class="col-md-4 text-center">
                                            <h6 class="text-muted">Moyenne Mensuelle</h6>
                                            <h4>{{ stats.avg_monthly_reservations }}</h4>
                                        </div>
                                        <div class="col-md-4 text-center">
                                            <h6 class="text-muted">Meilleur Mois</h6>
                                            <h4>{{ stats.best_month }} ({{ stats.best_month_count }})</h4>
                                        </div>
                                        <div class="col-md-4 text-center">
                                            <h6 class="text-muted">Croissance Annuelle</h6>
                                            <h4 class="text-{{ stats.year_over_year_growth > 0 ? 'success' : 'danger' }}">
                                                {{ stats.year_over_year_growth > 0 ? '+' : '' }}{{ stats.year_over_year_growth }}%
                                            </h4>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- User Reservation Stats -->
                        <div class="row mb-4">
                            <div class="col-lg-6" data-aos="fade-up" data-aos-delay="100">
                                <div class="dashboard-card p-4">
                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                        <div>
                                            <h5 class="mb-1">Utilisateurs les Plus Actifs</h5>
                                            <p class="text-muted mb-0">Top 5 des utilisateurs avec le plus de réservations</p>
                                        </div>
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Utilisateur</th>
                                                    <th>Réservations</th>
                                                    <th>Matériels Différents</th>
                                                    <th>Pourcentage</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for user in stats.top_users %}
                                                    <tr>
                                                        <td>{{ user.prenom }} {{ user.nom }}</td>
                                                        <td>{{ user.reservation_count }}</td>
                                                        <td>{{ user.unique_materials }}</td>
                                                        <td>
                                                            {% set percentage = (user.reservation_count / stats.total_reservations * 100)|round %}
                                                            <div class="d-flex align-items-center">
                                                                <div class="progress flex-grow-1 me-2" style="height: 6px;">
                                                                    <div class="progress-bar bg-primary" style="width: {{ percentage }}%"></div>
                                                                </div>
                                                                <span>{{ percentage }}%</span>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-lg-6" data-aos="fade-up" data-aos-delay="200">
                                <div class="dashboard-card p-4">
                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                        <div>
                                            <h5 class="mb-1">Quantité Moyenne par Réservation</h5>
                                            <p class="text-muted mb-0">Analyse des quantités réservées</p>
                                        </div>
                                    </div>
                                    <div class="chart-container" style="height: 300px;">
                                        <canvas id="quantityDistributionChart"></canvas>
                                    </div>
                                    <div class="row mt-4">
                                        <div class="col-md-4 text-center">
                                            <h6 class="text-muted">Quantité Moyenne</h6>
                                            <h4>{{ stats.avg_quantity_per_reservation }}</h4>
                                        </div>
                                        <div class="col-md-4 text-center">
                                            <h6 class="text-muted">Quantité Max</h6>
                                            <h4>{{ stats.max_quantity }}</h4>
                                        </div>
                                        <div class="col-md-4 text-center">
                                            <h6 class="text-muted">Quantité Min</h6>
                                            <h4>{{ stats.min_quantity }}</h4>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- / Content -->

                    <!-- Footer -->
                    <footer class="content-footer footer bg-footer-theme">
                        <div class="container-xxl d-flex flex-wrap justify-content-between py-2 flex-md-row flex-column">
                            <div class="mb-2 mb-md-0">
                                © 2023 Golden Touch
                            </div>
                        </div>
                    </footer>
                    <!-- / Footer -->

                    <div class="content-backdrop fade"></div>
                </div>
                <!-- Content wrapper -->
            </div>
            <!-- / Layout page -->
        </div>

        <!-- Overlay -->
        <div class="layout-overlay layout-menu-toggle"></div>

        <!-- Drag Target Area To SlideIn Menu On Small Screens -->
        <div class="drag-target"></div>
    </div>
    <!-- / Layout wrapper -->

    <!-- Core JS -->
    <script src="{{ asset('vendor/libs/jquery/jquery.js') }}"></script>
    <script src="{{ asset('vendor/libs/popper/popper.js') }}"></script>
    <script src="{{ asset('vendor/js/bootstrap.js') }}"></script>
    <script src="{{ asset('vendor/libs/perfect-scrollbar/perfect-scrollbar.js') }}"></script>
    <script src="{{ asset('vendor/libs/node-waves/node-waves.js') }}"></script>
    <script src="{{ asset('vendor/libs/hammer/hammer.js') }}"></script>
    <script src="{{ asset('vendor/libs/i18n/i18n.js') }}"></script>
    <script src="{{ asset('vendor/libs/typeahead-js/typeahead.js') }}"></script>
    <script src="{{ asset('vendor/js/menu.js') }}"></script>

    <!-- Vendors JS -->
    <script src="{{ asset('vendor/libs/apex-charts/apexcharts.js') }}"></script>
    <script src="{{ asset('vendor/libs/swiper/swiper.js') }}"></script>
    <script src="{{ asset('vendor/libs/datatables-bs5/datatables-bootstrap5.js') }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>

    <!-- Main JS -->
    <script src="{{ asset('js/main.js') }}"></script>

    <!-- Page JS -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize AOS animations
            AOS.init({
                duration: 800,
                easing: 'ease-in-out',
                once: true
            });

            // Reservation Trends Chart
            const reservationTrendsCtx = document.getElementById('reservationTrendsChart').getContext('2d');
            const reservationTrendsChart = new Chart(reservationTrendsCtx, {
                type: 'line',
                data: {
                    labels: [
                        {% for month in stats.monthly_reservations %}
                            '{{ month.month }}'{% if not loop.last %},{% endif %}
                        {% endfor %}
                    ],
                    datasets: [{
                        label: 'Réservations',
                        data: [
                            {% for month in stats.monthly_reservations %}
                                {{ month.count }}{% if not loop.last %},{% endif %}
                            {% endfor %}
                        ],
                        borderColor: '#7367F0',
                        backgroundColor: 'rgba(115, 103, 240, 0.1)',
                        borderWidth: 2,
                        pointBackgroundColor: '#7367F0',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 4,
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    return `Réservations: ${context.raw}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                drawBorder: false,
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            ticks: {
                                stepSize: 5
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });

            // Status Distribution Chart
            const statusDistributionCtx = document.getElementById('statusDistributionChart').getContext('2d');
            const statusDistributionChart = new Chart(statusDistributionCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Confirmées', 'En Attente', 'Annulées'],
                    datasets: [{
                        data: [
                            {{ stats.confirmed_reservations }},
                            {{ stats.pending_reservations }},
                            {{ stats.cancelled_reservations }}
                        ],
                        backgroundColor: [
                            '#28C76F',
                            '#FF9F43',
                            '#EA5455'
                        ],
                        borderWidth: 0,
                        hoverOffset: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((acc, data) => acc + data, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });

            // Monthly Reservation Chart
            const monthlyReservationCtx = document.getElementById('monthlyReservationChart').getContext('2d');
            const monthlyReservationChart = new Chart(monthlyReservationCtx, {
                type: 'bar',
                data: {
                    labels: [
                        {% for month in stats.monthly_reservations %}
                            '{{ month.month }}'{% if not loop.last %},{% endif %}
                        {% endfor %}
                    ],
                    datasets: [{
                        label: 'Réservations',
                        data: [
                            {% for month in stats.monthly_reservations %}
                                {{ month.count }}{% if not loop.last %},{% endif %}
                            {% endfor %}
                        ],
                        backgroundColor: 'rgba(115, 103, 240, 0.7)',
                        borderColor: '#7367F0',
                        borderWidth: 1,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                drawBorder: false,
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });

            // Quantity Distribution Chart
            const quantityDistributionCtx = document.getElementById('quantityDistributionChart').getContext('2d');
            const quantityDistributionChart = new Chart(quantityDistributionCtx, {
                type: 'bar',
                data: {
                    labels: [
                        {% for qty in stats.quantity_distribution %}
                            '{{ qty.quantity }}'{% if not loop.last %},{% endif %}
                        {% endfor %}
                    ],
                    datasets: [{
                        label: 'Nombre de Réservations',
                        data: [
                            {% for qty in stats.quantity_distribution %}
                                {{ qty.count }}{% if not loop.last %},{% endif %}
                            {% endfor %}
                        ],
                        backgroundColor: 'rgba(40, 199, 111, 0.7)',
                        borderColor: '#28C76F',
                        borderWidth: 1,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                drawBorder: false,
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });

            // Function to show detailed statistics when a card is clicked
            function showAdvancedStatDetails(statType) {
                // Default data structure for statistics
                const detailedStats = {
                    reservations: {
                        title: 'Statistiques Détaillées des Réservations',
                        icon: 'ri-calendar-check-line',
                        color: 'primary',
                        today: {
                            value: 25,
                            growth: '+15%'
                        },
                        thisWeek: {
                            value: 142,
                            growth: '+22%'
                        },
                        thisMonth: {
                            value: 587,
                            growth: '+12.5%'
                        },
                        thisYear: {
                            value: 2845,
                            growth: '+18.3%'
                        },
                        totalSales: {{ stats.total_reservations }},
                        growthRate: '+{{ stats.reservation_growth }}%'
                    },
                    confirmed: {
                        title: 'Statistiques des Réservations Confirmées',
                        icon: 'ri-checkbox-circle-line',
                        color: 'success',
                        today: {
                            value: 18,
                            growth: '+10%'
                        },
                        thisWeek: {
                            value: 98,
                            growth: '+15%'
                        },
                        thisMonth: {
                            value: 412,
                            growth: '+8.5%'
                        },
                        thisYear: {
                            value: 1845,
                            growth: '+14.3%'
                        },
                        totalSales: {{ stats.confirmed_reservations }},
                        growthRate: '+{{ ((stats.confirmed_reservations / stats.total_reservations) * 100)|round }}%'
                    },
                    pending: {
                        title: 'Statistiques des Réservations en Attente',
                        icon: 'ri-time-line',
                        color: 'warning',
                        today: {
                            value: 5,
                            growth: '+2%'
                        },
                        thisWeek: {
                            value: 32,
                            growth: '+5%'
                        },
                        thisMonth: {
                            value: 125,
                            growth: '+3.5%'
                        },
                        thisYear: {
                            value: 745,
                            growth: '+4.3%'
                        },
                        totalSales: {{ stats.pending_reservations }},
                        growthRate: '+{{ ((stats.pending_reservations / stats.total_reservations) * 100)|round }}%'
                    },
                    cancelled: {
                        title: 'Statistiques des Réservations Annulées',
                        icon: 'ri-close-circle-line',
                        color: 'danger',
                        today: {
                            value: 2,
                            growth: '-1%'
                        },
                        thisWeek: {
                            value: 12,
                            growth: '-2%'
                        },
                        thisMonth: {
                            value: 50,
                            growth: '-1.5%'
                        },
                        thisYear: {
                            value: 255,
                            growth: '-0.3%'
                        },
                        totalSales: {{ stats.cancelled_reservations }},
                        growthRate: '{{ ((stats.cancelled_reservations / stats.total_reservations) * 100)|round }}%'
                    }
                };
                
                // Get the selected stat data
                const statData = detailedStats[statType];
                
                // Update modal content with the selected stat data
                document.getElementById('statDetailsTitle').textContent = statData.title;
                document.getElementById('statDetailsIcon').className = `${statData.icon} text-${statData.color}`;
                
                // Update the detailed statistics
                document.getElementById('statToday').textContent = statData.today.value;
                document.getElementById('statTodayGrowth').textContent = statData.today.growth;
                
                document.getElementById('statThisWeek').textContent = statData.thisWeek.value;
                document.getElementById('statThisWeekGrowth').textContent = statData.thisWeek.growth;
                
                document.getElementById('statThisMonth').textContent = statData.thisMonth.value;
                document.getElementById('statThisMonthGrowth').textContent = statData.thisMonth.growth;
                
                document.getElementById('statThisYear').textContent = statData.thisYear.value;
                document.getElementById('statThisYearGrowth').textContent = statData.thisYear.growth;
                
                document.getElementById('statTotalSales').textContent = statData.totalSales;
                document.getElementById('statTotalGrowth').textContent = statData.growthRate;
                
                // Show the modal
                const statDetailsModal = new bootstrap.Modal(document.getElementById('statDetailsModal'));
                statDetailsModal.show();
            }
        });
    </script>
    
    <!-- Statistics Details Modal -->
    <div class="modal fade" id="statDetailsModal" tabindex="-1" aria-labelledby="statDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="statDetailsModalLabel">
                        <i id="statDetailsIcon" class="ri-calendar-check-line text-primary me-2"></i>
                        <span id="statDetailsTitle">Statistiques Détaillées</span>
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-4">
                        <div class="col-12 mb-4">
                            <div class="dashboard-card p-4">
                                <h5 class="mb-3">Total des Réservations</h5>
                                <div class="d-flex align-items-center">
                                    <h2 class="mb-0" id="statTotalSales">0</h2>
                                    <span class="badge bg-success ms-2" id="statTotalGrowth">+0%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <h5 class="mb-3">Analyse des Réservations</h5>
                    <div class="row g-3 mb-4">
                        <!-- Today -->
                        <div class="col-md-6 col-lg-3">
                            <div class="dashboard-card p-3">
                                <h6 class="text-muted mb-2">Aujourd'hui</h6>
                                <div class="d-flex align-items-baseline">
                                    <h3 class="mb-0" id="statToday">25</h3>
                                    <small class="text-success ms-2" id="statTodayGrowth">+15%</small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- This Week -->
                        <div class="col-md-6 col-lg-3">
                            <div class="dashboard-card p-3">
                                <h6 class="text-muted mb-2">Cette Semaine</h6>
                                <div class="d-flex align-items-baseline">
                                    <h3 class="mb-0" id="statThisWeek">142</h3>
                                    <small class="text-success ms-2" id="statThisWeekGrowth">+22%</small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- This Month -->
                        <div class="col-md-6 col-lg-3">
                            <div class="dashboard-card p-3">
                                <h6 class="text-muted mb-2">Ce Mois</h6>
                                <div class="d-flex align-items-baseline">
                                    <h3 class="mb-0" id="statThisMonth">587</h3>
                                    <small class="text-success ms-2" id="statThisMonthGrowth">+12.5%</small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- This Year -->
                        <div class="col-md-6 col-lg-3">
                            <div class="dashboard-card p-3">
                                <h6 class="text-muted mb-2">Cette Année</h6>
                                <div class="d-flex align-items-baseline">
                                    <h3 class="mb-0" id="statThisYear">2,845</h3>
                                    <small class="text-success ms-2" id="statThisYearGrowth">+18.3%</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-12">
                            <div class="dashboard-card p-4">
                                <h5 class="mb-3">Tendance des Réservations</h5>
                                <div style="height: 250px;">
                                    <canvas id="statDetailsTrendChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
                    <button type="button" class="btn btn-primary">Télécharger Rapport</button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>